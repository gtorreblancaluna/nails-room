<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mx.com.proyect.puntoventa.web.dao.InventoryDAO">

	<resultMap id="itemResultMap" type="itemDTO">
		<result property="itemId" column="cl_inventario" />
		<result property="date" column="fecha_alta" />		
		<result property="description" column="descripcion" />
		<result property="unitMeasurement" column="unidad_medida" />
		<result property="amountEntry" column="cantidad_entrada" />
		<result property="amountOutput" column="cantidad_salida" />
		<result property="salePrice" column="precio_venta" />
		<result property="stock" column="cantidad_existente" />
		<result property="fgStatus" column="fg_estatus" />		
		<result property="storeDTO.storeId" column="cl_almacen" />
		<result property="storeDTO.description" column="ds_descripcion" />		
	</resultMap>
	
	<resultMap id="storeResultMap" type="storeDTO">
		<result property="storeId" column="cl_almacen" />
		<result property="description" column="ds_descripcion" />		
		<result property="fgStatus" column="fg_estatus" />		
	</resultMap>

	<select id="findByIdItem" resultMap="itemResultMap" parameterType="long">
		SELECT i.*, a.cl_almacen, a.ds_descripcion
		FROM c_inventario i INNER JOIN c_almacen a ON (i.cl_almacen = a.cl_almacen)
		WHERE cl_inventario = #{id}
	</select>
	
	<select id="validateItem" resultMap="itemResultMap" parameterType="loginForm">
		SELECT * FROM c_inventario WHERE email = #{email} AND password = #{password} 
		AND fg_activo = '1'
	</select>

	<select id="getAllItems" resultMap="itemResultMap">
		SELECT i.*, a.cl_almacen, a.ds_descripcion
		FROM c_inventario i INNER JOIN c_almacen a ON (i.cl_almacen = a.cl_almacen)
		WHERE i.fg_estatus = '1'
	</select>

	<insert id="addItem" parameterType="accountDTO">
		INSERT INTO c_inventario
		(cl_almacen,descripcion,unidad_medida,cantidad_entrada,cantidad_salida,precio_venta,cantidad_existente)
		values
		(#{storeDTO.storeId},#{description},#{unitMeasurement},#{amountEntry},#{amountOutput},#{salePrice},#{stock})
	</insert>
	<update id="updateItem" parameterType="accountDTO">
		UPDATE c_inventario SET
		cl_almacen = #{storeDTO.storeId},
		descripcion = #{description},
		unidad_medida = #{unitMeasurement},
		cantidad_entrada =	#{amountEntry},
		cantidad_salida = #{amountOutput},
		precio_venta = #{salePrice},
		cantidad_existente = #{stock},
		WHERE cl_inventario = #{itemId}
	</update>
	<delete id="deleteItem" parameterType="accountDTO">
		UPDATE c_inventario SET fg_estatus = '0' WHERE cl_inventario = #{itemId}
	</delete>
	
	<select id="getAllStore" resultMap="storeResultMap">
		SELECT * FROM c_almacen WHERE fg_estatus = '1'
	</select>
</mapper>